<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>BloodCircR</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/expression.css">
    <link rel="stylesheet" type="text/css" href="elementui/theme-chalk/index.css" />
    <link rel="icon" href="images/1_1.png" type="image/x-icon">

    <script src="js/vue.js"></script>
    <script src="js/elementui.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script src="js/axios.min.js"></script>
    <script src="js/header-component.js"></script>
    <script src="js/footer-component.js"></script>
</head>
<style>
    .title-link {
        text-decoration: none;
        color: #B94A4A;
    }

    .title-link:hover {
        text-decoration: underline;
        /* 其他悬停时的样式 */
    }

    .el-button:hover {
        color: #B94A4A;
        border-color: #E6B7B7;
        background-color: #E6B7B7;
    }

    .el-button:active {
        color: #B94A4A;
        border-color: #E6B7B7;
        background-color: #E6B7B7;
    }

    .el-button:focus {
        color: #B94A4A;
        border-color: #E6B7B7;
        background-color: #E6B7B7;
    }

    /* 自定义按钮样式 */
    .el-button.custom-button {
        border-color: #DCDFE6;
        background-color: #B94A4A;
        color: white;
    }

    .el-button.custom-button:hover {
        color: #B94A4A;
        border-color: #E6B7B7;
        background-color: #E6B7B7;
    }

    .el-button.custom-button:active {
        color: #B94A4A;
        border-color: #E6B7B7;
        background-color: #E6B7B7;
    }

    .el-button.custom-button:focus {
        color: #B94A4A;
        border-color: #E6B7B7;
        background-color: #E6B7B7;
    }


    .img_container {
        width: 100%;
        /* 容器的宽度 */
        overflow-x: auto;
        /* 启用水平滚动条 */
        white-space: nowrap;
        /* 防止图片换行 */
        /* border: 1px solid #ccc;  */
        /* display: flex;
        align-items: end;
        justify-content: center; */
        text-align: center;
    }

    .el-tabs__item {
        padding: 20px;
        font-size: 25px;
        line-height: 0;
        font-weight: 500;
        color: #333333;
    }

    ul {
        padding: 0px 40px;

        font-size: 20px;
        color: #333333;
        /* font-weight: 700; */
    }

    ul .text {
        font-size: 16px;
        color: #333333;
        font-weight: normal;
        padding: 10px 0;
    }
</style>
<style>
    .background {
        background-image: url(../images/u62.png);
        background-repeat: no-repeat;
        background-size: cover;
        width: 100%;
        height: 500px;
    }
</style>
<style>
    .image-with-text {
        position: relative;
    }

    .text-overlay {
        position: absolute;
        top: 80px;
        left: 15%;
        background-color: rgba(0, 0, 0, 0.193);
        color: white;
        padding: 80px 20px;
        width: 70%;
        height: 180px;
    }

    .text-overlay .text {
        font-size: 30px;
        font-weight: bold;
        color: white;
    }

    .el-tag.el-tag--info {
        color: #333333;

    }
	/* 使 title 加粗 */
	.el-popover__title {
	    font-weight: 700;
	    color: #333333; /* 使标题文字为黑色 */
	}
	
	/* 使 content 文字为黑色 */
	.el-popover__content {
	    color: #333333; /* 使内容文字为黑色 */
	}

</style>

<body>
    <div id="app" :class="{ loaded: isLoaded }">
        <!-- 使用定义的 header 组件 -->
        <app-header></app-header>
        <div class="background" style="margin-top: 100px; margin-bottom: 0;">
            <div class="image-with-text">
                <div class="text-overlay">
                    <div class="text" style="font-size: 40px;">Expression</div>
                    <div style="border-bottom: 2px solid white; width: 20%; margin: 20px 0;"></div>
                    <div class="text">Personalized analysis of circRNA expressions in human blood samples across studies
                    </div>
                </div>
            </div>
        </div>

        <div class="main" style="margin-top: 20px; min-height: calc(100vh - 360px);">
            <div class="left">
                <el-card>
                    <p style="padding-top: 10px;font-size:22px;margin-bottom: 10px;">Disease:</p>
                    <el-select v-model="selectedDiseases" @change="fetchPhenotypes" multiple
                        placeholder="Select Disease" style="width: 100%;">
                        <el-option v-for="disease in diseases" :key="disease" :label="disease"
                            :value="disease"></el-option>
                    </el-select>

                    <p style="padding-top: 10px;font-size:22px;margin-bottom: 10px;">Phenotype:</p>
                    <el-select v-model="selectedPhenotypes" @change="fetchDatasets" multiple
                        placeholder="Select Phenotype" style="width: 100%">
                        <el-option v-for="phenotype in phenotypes" :key="phenotype" :label="phenotype"
                            :value="phenotype"></el-option>
                    </el-select>

                    <p style="padding-top: 10px;font-size:22px;margin-bottom: 10px;">Dataset:</p>
                    <el-select v-model="selectedDatasets" multiple placeholder="Select Dataset" style="width: 100%">
                        <el-option v-for="dataset in datasets" :key="dataset" :label="dataset"
                            :value="dataset"></el-option>
                    </el-select>

                    <div style="display: flex; padding-top: 20px;">
                        <el-button type="primary" @click="get_plots()">Submit</el-button>
                        <el-button type="primary" @click="reset()">Reset</el-button>
                    </div>

                </el-card>
            </div>

            <div class="right">
                <el-tabs v-model="activeName" stretch=true @tab-click="handleTabClick">
                    <el-tab-pane label="Landscape" name="first">
                        <div class="sec2">
                            <div class="header">
                                <span style="padding-left: 10px;">circRNA Expression across group</span>
                                <el-popover placement="top-start" title="Illustration" width="200" trigger="hover"
                                    content="这是一段内容,这是一段内容,这是一段内容,这是一段内容。">
                                    <img src="images/warning.png" slot="reference" alt="icon" class="icon-image"
                                        > <!-- 这里是图标图片 -->
                                </el-popover>
                            </div>
                            <el-card>
                                <div v-loading="loading1" element-loading-text="Loading"
                                    element-loading-spinner="el-icon-loading"
                                    element-loading-background="rgba(255, 255, 255, 0.8)" style="text-align: center;"
                                    style="padding:20px;">
                                    <!-- 图显示主体 -->
                                    <div v-for="([datasetname, image], index) in Object.entries(showimages1)"
                                        :key="datasetname">
                                        <div class="img_container">
                                            <img :src="image" style="height: 450px;width:auto;" alt="">
                                        </div>
                                        <div class="top_btn">
                                            <el-button type="primary" @click="export_image(1)"
                                                style="width:150px; margin-right: 20px;margin-top: 20px;">Export
                                                Image</el-button>
                                            <el-button type="primary" @click="export_data(1)"
                                                style="width:150px; margin-right: 20px; margin-top: 20px;">Export
                                                Data</el-button>
                                        </div>
                                    </div>
                                </div>
                                <div id="footer-text1" style="display: none;" class="my-accordion accordion">
                                    <input type="checkbox" id="collapse1">
                                    <article>
                                        <label for="collapse1">Click here for a detailed description of the methods and
                                            results.</label>
                                        <ul style="font-weight: 700;">
                                            <li style="padding-top:10px;">
                                                Methods
                                            </li>
                                            <div class="text">Based on the expression of circRNAs in total TPM,
                                                BloodCircR provides expression profiles of different groups in different
                                                phenotypes for 7 disease types (Cancer disease,Genetic
                                                disease,Infectious disease,
                                                Mental disorder,Metabolic disease,Retinal disease,Vaccine) and 14
                                                phenotypes(HCC,CF,Ebola,Chikv,Zika,TB,COVID,MISC,
                                                ILD,ID,MDD,T2D,PVR,Group B meningococcal vaccine),
                                                each of which has more than 4 pairs of disease and control samples.
                                                This module used One-Way ANOVA to compare the means of multiple groups
                                                to determine whether they are significantly different.</div>
                                            <li>
                                                Interpretation
                                                <ul>
                                                    <li>
                                                        BloodCircR provides result figures, including:
                                                    </li>
                                                    <div class="text">After selecting the disease type, phenotype, and
                                                        dataset through the menu bar on the left,
                                                        BloodCircR will display a box plot of total circRNA expression
                                                        for a single phenotype or for different groups of multiple
                                                        phenotypes.</div>
                                                    <li>
                                                        BloodCircR provides table for downloading, including:

                                                       
                                                        <div class="text">This table provides the expression of
                                                            Total circular RNA in different phenotype groups,
                                                            including sampleID, disease type, group name, dataset
                                                            name, and TPM value.
                                                        </div>
                                                    </li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </article>
                                </div>
                            </el-card>
                        </div>
                    </el-tab-pane>
                    <el-tab-pane label="Expression" name="second">
                        <div class="sec2">
                            <div class="header">
                                <span>BSJ/circRNA/host gene Expression Analysis</span>
                                <el-popover placement="top-start" title="Illustration" width="200" trigger="hover"
                                    content="这是一段内容,这是一段内容,这是一段内容,这是一段内容。">
                                    <img src="images/warning.png" slot="reference" alt="icon" class="icon-image"
                                        > <!-- 这里是图标图片 -->
                                </el-popover>
                            </div>
                            <el-card>
                                <div v-loading="loading2" element-loading-text="Loading"
                                    element-loading-spinner="el-icon-loading"
                                    element-loading-background="rgba(255, 255, 255, 0.8)" style="text-align: center;"
                                    style="padding:20px;">
                                    <!-- 上方按钮显示主体 -->
                                    <div
                                        style="display: flex; justify-content: start; flex-wrap:nowrap; margin-bottom:20px;">
                                        <el-select v-model="selectedMarker" placeholder="Please Select Marker"
                                            @change="changeMarkerName()" style="width: 250px; display: block;">
                                            <el-option v-for="marker in allSelectedMarkers" :key="marker"
                                                :label="formatLabel(marker)" :value="marker"></el-option>
                                        </el-select>
                                        <div style="width:80%">
                                            <div style="margin:0 20px; text-align: left;">
                                                <span style="font-size: 20px;">Input BSJ/circRNA/host gene: </span>
                                            </div>
                                            <div style="margin:0 20px; text-align: left;">
                                                <el-input type="textarea" :rows="4" v-model="circRNAs"
                                                    :placeholder="dynamicPlaceholder" @keydown.native="handleTabKey1"
                                                    @blur="handleInputBlur()" style="width: 100%; margin-bottom: 20px;">
                                                </el-input>
                                            </div>

                                        </div>
                                    </div>
                                    <div
                                        style="display: flex; justify-content: start; flex-wrap:nowrap; margin-bottom:20px;">
                                        <el-select v-model="selectedCircRNA" placeholder="Please Select Name"
                                            style="width: 250px;  display: block;">
                                            <el-option v-for="circRNA in allSelectedCircRNAs" :key="circRNA"
                                                :label="circRNA" :value="circRNA"></el-option>
                                        </el-select>
                                        <el-button type="primary" @click="getcircRNAplot()"
                                            style=" width:100px; margin-left:20px;">Submit</el-button>
                                    </div>
                                    <!-- 图显示主体 -->
                                    <div v-for="([datasetname, image], index) in Object.entries(showimages2)"
                                        :key="datasetname">
                                        <div class="img_container">
                                            <img :src="image" style="height: 450px;width:auto;" alt="">
                                        </div>
                                        <div class="top_btn">
                                            <el-button type="primary" @click="export_image(2)"
                                                style="width:150px; margin-right: 20px;margin-top: 20px;">Export
                                                Image</el-button>
                                            <el-button type="primary" @click="export_data(2)"
                                                style="width:150px; margin-right: 20px; margin-top: 20px;">Export
                                                Data</el-button>
                                        </div>
                                    </div>
                                </div>
                                <div id="footer-text2" style="display: none;" class="my-accordion accordion">
                                    <input type="checkbox" id="collapse2">
                                    <article>
                                        <label for="collapse2">Click here for a detailed description of the methods and
                                            results.</label>
                                        <ul style="font-weight: 700;">
                                            <li style="padding-top:10px;">
                                                Methods
                                            </li>
                                            <div class="text">Based on the expression of circRNAs in total TPM,
                                                BloodCircR provides expression profiles of different groups in different
                                                phenotypes for 7 disease types (Cancer disease,Genetic
                                                disease,Infectious disease,
                                                Mental disorder,Metabolic disease,Retinal disease,Vaccine) and 14
                                                phenotypes(HCC,CF,Ebola,Chikv,Zika,TB,COVID,MISC,
                                                ILD,ID,MDD,T2D,PVR,Group B meningococcal vaccine),
                                                each of which has more than 4 pairs of disease and control samples.
                                                This module used One-Way ANOVA to compare the means of multiple groups
                                                to determine whether they are significantly different
                                                at BSJ,circRNA,gene level.</div>
                                            <li>
                                                Interpretation
                                                <ul>
                                                    <li>
                                                        BloodCircR provides result figures, including:
                                                    </li>
                                                    <div class="text">After selecting the disease type, phenotype, and
                                                        dataset through the menu bar on the left,
                                                        BloodCircR will display a box plot of total circRNA expression
                                                        for a single phenotype or for different groups of multiple
                                                        phenotypes.</div>
                                                    <li>
                                                        BloodCircR provides table for downloading, including:

                                                        <!--  <li>
                                                                Bubble plot:
                                                            </li>-->
                                                        <div class="text" style="text-align: left;">This table provides
                                                            the expression of
                                                            Total circular RNA in different phenotype groups,
                                                            including sampleID, disease type, group name, dataset
                                                            name, and TPM value.
                                                        </div>
                                                    </li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </article>
                                </div>
                            </el-card>
                        </div>
                    </el-tab-pane>
                    <el-tab-pane label="Differential Expression" name="third">
                        <div class="sec2">
                            <div class="header">
                                <span>Gene Differential Expression</span>
                                <el-popover placement="top-start" title="Illustration" width="200" trigger="hover"
                                    content="这是一段内容,这是一段内容,这是一段内容,这是一段内容。">
                                    <img src="images/warning.png" slot="reference" alt="icon" class="icon-image"
                                        > <!-- 这里是图标图片 -->
                                </el-popover>
                            </div>
                            <el-card>
                                <div v-loading="loading3" element-loading-text="Loading"
                                    element-loading-spinner="el-icon-loading"
                                    element-loading-background="rgba(255, 255, 255, 0.8)" style="text-align: center;"
                                    style="padding:20px;">
                                    <!-- 上方按钮显示主体 -->
                                    <div
                                        style="display: flex; justify-content: start; flex-wrap:nowrap; margin-bottom:20px;">
                                        <el-select v-model="selectedMarker1" placeholder="Please Select Marker"
                                            style="width: 200px; margin-right: 20px; display: block;">
                                            <el-option v-for="marker in allSelectedMarkers" :key="marker"
                                                :label="formatLabel(marker)" :value="marker"></el-option>
                                        </el-select>
                                        <el-select v-model="selectedDataset3" @change="selectimage3"
                                            placeholder="Please Select Dataset"
                                            style="width: 250px;margin-right: 20px; display: block;">
                                            <el-option v-for="dataset in selectedDatasets" :key="dataset"
                                                :label="dataset" :value="dataset"></el-option>
                                        </el-select>
                                        <el-select v-model="selectedCompare1" placeholder="Select Compare"
                                            style="width: 200px; margin-right: 20px; display: block;">
                                            <el-option v-for="compare1 in compares1" :key="compare1" :label="compare1"
                                                :value="compare1"></el-option>
                                        </el-select>
                                    </div>
                                    <div
                                        style="display: flex;justify-content: end; align-items: center; margin-bottom: 20px;">
                                        PValue:<el-input v-model="pvalue1" placeholder="pvalue" type="number"
                                            step="0.05" style="width: 100px; margin: 0 20px;"></el-input>
                                        FoldChange:<el-input v-model="FoldChange1" placeholder="FoldChange"
                                            type="number" style="width: 100px;  margin: 0 20px;"></el-input>
                                        detectR:<el-input v-model="detectR1" placeholder="detectR" type="number"
                                            style="width: 100px;  margin-left: 20px;"></el-input>
                                        <el-button type="primary" style="width:100px; margin-left: 20px;"
                                            @click="get_plot3()">Go</el-button>
                                    </div>
                                    <!-- 图显示主体 -->
                                    <div v-for="([datasetname, image], index) in Object.entries(showimages3)"
                                        :key="datasetname">
                                        <div class="img_container">
                                            <img :src="image" style="width:65%;" alt="">
                                        </div>
                                        <div class="top_btn">
                                            <el-button type="primary" @click="export_image(3)"
                                                style="width:150px; margin-left: 20px;margin-top: 20px;">Export
                                                Image</el-button>
                                            <el-button type="primary" @click="export_data(3)"
                                                style="width:150px; margin-left: 20px; margin-top: 20px;">Export
                                                Data</el-button>
                                        </div>
                                    </div>
                                </div>
                                <div id="footer-text3" style="display: none;" class="my-accordion accordion">
                                    <input type="checkbox" id="collapse3">
                                    <article>
                                        <label for="collapse3">Click here for a detailed description of the methods and
                                            results.</label>
                                        <ul style="font-weight: 700;">
                                            <li style="padding-top:10px;">
                                                Methods
                                            </li>
                                            <div class="text">Based on normalized and batch corrected BSJ,circRNA,gene
                                                expression,
                                                BloodCircR provides differential expression analysis of different groups
                                                in different
                                                phenotypes for 7 disease types (Cancer disease,Genetic
                                                disease,Infectious disease,
                                                Mental disorder,Metabolic disease,Retinal disease,Vaccine) and 14
                                                phenotypes(HCC,CF,Ebola,Chikv,Zika,TB,COVID,MISC,
                                                ILD,ID,MDD,T2D,PVR,Group B meningococcal vaccine),
                                                each of which has more than 4 pairs of disease and control samples.
                                                The fold change is calculated by mean(Case) / mean(Control),and the
                                                p-value was estimated by t-test.</div>
                                            <li>
                                                Interpretation
                                                <ul>
                                                    <li>
                                                        BloodCircR provides result figures, including:
                                                    </li>
                                                    <div class="text">The volcano plot presents the fold
                                                        change,up-regulated genes and
                                                        down-regulated genes.</div>
                                                    <li>
                                                        BloodCircR provides table for downloading, including:

                                                        <!--  <li>
                                                            Bubble plot:
                                                        </li>-->
                                                        <div class="text">The table presents detailed information about
                                                            differential expression analysis,including baseMeas,
                                                            log2FoldChange, lfcSE, stat, pvalue, padj,
                                                            genename, detectN, detectR, host_gene, Significant.
                                                        </div>
                                                    </li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </article>
                                </div>
                            </el-card>
                        </div>
                        <div class="sec2">
                            <div class="header">
                                <span>Enrichments</span>
                                <el-popover placement="top-start" title="Illustration" width="200" trigger="hover"
                                content="这是一段内容,这是一段内容,这是一段内容,这是一段内容。">
                                <img src="images/warning.png" slot="reference" alt="icon" class="icon-image"
                                    > <!-- 这里是图标图片 -->
                                </el-popover>
                            </el-popover>
                            </div>
                            <el-card>
                                <div v-loading="loading4" element-loading-text="Loading"
                                    element-loading-spinner="el-icon-loading"
                                    element-loading-background="rgba(255, 255, 255, 0.8)" style="text-align: center;"
                                    style="padding:20px;">
                                    <!-- 上方按钮显示主体 -->
                                    <div
                                        style="display: flex; justify-content: start; flex-wrap:nowrap; margin-bottom:20px;">
                                        <el-select v-model="selectedMarker2" placeholder="Please Select Marker"
                                            style="width: 200px; margin-right: 20px; display: block;">
                                            <el-option v-for="marker in allSelectedMarkers" :key="marker"
                                                :label="formatLabel(marker)" :value="marker"></el-option>
                                        </el-select>
                                        <el-select v-model="selectedType2" placeholder="Select Type"
                                            style="width: 150px;  margin-right: 20px; display: block;">
                                            <el-option v-for="type2 in types2" :key="type2" :label="type2"
                                                :value="type2"></el-option>
                                        </el-select>
                                        <el-select v-model="selectedDataset4" @change="selectimage4"
                                            placeholder="Please Select Dataset"
                                            style="width: 250px; margin-right: 20px; display: block;">
                                            <el-option v-for="dataset in selectedDatasets" :key="dataset"
                                                :label="dataset" :value="dataset"></el-option>
                                        </el-select>
                                        <el-select v-model="selectedCompare2" placeholder="Select Compare"
                                            style="width: 200px; margin-right: 20px; display: block;">
                                            <el-option v-for="compare2 in compares2" :key="compare2" :label="compare2"
                                                :value="compare2"></el-option>
                                        </el-select>
                                    </div>
                                    <div
                                        style="display: flex;justify-content: end; align-items: center; margin-bottom: 20px;">
                                        PValue:<el-input v-model="pvalue2" placeholder="pvalue" type="number"
                                            step="0.05" style="width: 100px; margin: 0 20px;"></el-input>
                                        FoldChange:<el-input v-model="FoldChange2" placeholder="FoldChange"
                                            type="number" style="width: 100px;  margin: 0 20px;"></el-input>
                                        detectR:<el-input v-model="detectR2" placeholder="detectR" type="number"
                                            step="0.1" style="width: 100px; margin: 0 20px;"></el-input>
                                        <!-- Number:<el-input v-model="Number2" placeholder="Number" type="number"
						                    style="width: 100px;  margin-left: 20px;"></el-input>-->
                                        <el-button type="primary" style="width:100px; margin-left: 20px;"
                                            @click="get_plot4()">Go</el-button>
                                    </div>
                                    <!-- 图显示主体 -->
                                    <div v-for="([datasetname, image], index) in Object.entries(showimages4)"
                                        :key="datasetname">
                                        <div class="img_container">
                                            <!-- <img :src="image" style="height: 450px;width:auto;" alt=""> -->
                                            <img :src="image" style="width:60%;" alt="">
                                        </div>
                                        <div class="top_btn">
                                            <el-button type="primary" @click="export_image(4)"
                                                style="width:150px; margin-left: 20px;margin-top: 20px;">Export
                                                Image</el-button>
                                            <el-button type="primary" @click="export_data(4)"
                                                style="width:150px; margin-left: 20px; margin-top: 20px;">Export
                                                Data</el-button>
                                        </div>
                                    </div>
                                </div>
                                <div id="footer-text4" style="display: none;" class="my-accordion accordion">
                                    <input type="checkbox" id="collapse5">
                                    <article>
                                        <label for="collapse5">Click here for a detailed description of the methods and
                                            results.</label>
                                        <ul style="font-weight: 700;">
                                            <li style="padding-top:10px;">
                                                Methods
                                            </li>
                                            <div class="text">Based on the expression of circRNAs in total TPM,
                                                BloodCircR provides expression profiles of different groups in different
                                                phenotypes for 8 disease types () and 12 phenotypes,
                                                each of which has more than 4 pairs of disease and control samples.
                                                The expression level was calculated by xxx, and the p value was
                                                estimated by t test.</div>
                                            <li>
                                                Interpretation
                                                <ul>
                                                    <li>
                                                        BloodCircR provides result figures, including:
                                                    </li>
                                                    <div class="text">After selecting the disease type, phenotype, and
                                                        dataset through the menu bar on the left,
                                                        BloodCircR will display a box plot of total circRNA expression
                                                        for a single phenotype or for different groups of multiple
                                                        phenotypes.</div>
                                                    <li>
                                                        BloodCircR provides table for downloading, including:

                                                        <!--  <li>
						                                        Bubble plot:
						                                    </li>-->
                                                        <div class="text">This table provides the expression of
                                                            Total circular RNA in different phenotype groups,
                                                            including sampleID, disease type, group name, dataset
                                                            name, and TPM value.
                                                        </div>
                                                    </li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </article>
                                </div>
                            </el-card>
                        </div>
                        <div class="sec2">
                            <div class="header">
                                <span>Differential Expression Comparison</span>
                                <el-popover placement="top-start" title="Illustration" width="200" trigger="hover"
                                content="这是一段内容,这是一段内容,这是一段内容,这是一段内容。">
                                <img src="images/warning.png" slot="reference" alt="icon" class="icon-image"
                                    > <!-- 这里是图标图片 -->
                                </el-popover>
                            </div>
                            <el-card>
                                <div v-loading="loading5" element-loading-text="Loading"
                                    element-loading-spinner="el-icon-loading"
                                    element-loading-background="rgba(255, 255, 255, 0.8)" style="text-align: center;"
                                    style="padding:20px;">
                                    <!-- 上方按钮显示主体 -->
                                    <div
                                        style="display: flex; justify-content: start; flex-wrap:nowrap; margin-bottom:20px;">
                                        <el-select v-model="selectedDataset5" @change="selectimage5"
                                            placeholder="Please Select Dataset"
                                            style="width: 250px;margin-right: 20px;display: block;">
                                            <el-option v-for="dataset in selectedDatasets" :key="dataset"
                                                :label="dataset" :value="dataset"></el-option>
                                        </el-select>
                                        <el-select v-model="selectedCompare3" placeholder="Select Compare"
                                            style="width: 200px; margin-right: 20px; display: block;">
                                            <el-option v-for="compare3 in compares3" :key="compare3" :label="compare3"
                                                :value="compare3"></el-option>
                                        </el-select>
                                    </div>
                                    <div
                                        style="display: flex;justify-content: end; align-items: center; margin-bottom: 20px;">
                                        PValue:<el-input v-model="pvalue3" placeholder="pvalue" type="number"
                                            step="0.05" style="width: 100px; margin: 0 20px;"></el-input>
                                        FoldChange:<el-input v-model="FoldChange3" placeholder="FoldChange"
                                            type="number" style="width: 100px;  margin: 0 20px;"></el-input>
                                        <el-button type="primary" style="width:100px; margin-left: 20px;"
                                            @click="get_plot5()">Go</el-button>
                                    </div>
                                    <!-- 图显示主体 -->
                                    <div v-for="([datasetname, image], index) in Object.entries(showimages5)"
                                        :key="datasetname">
                                        <div class="img_container">
                                            <img :src="image" style="width:70%;" alt="">
                                        </div>
                                        <div class="top_btn">
                                            <el-button type="primary" @click="export_image(5)"
                                                style="width:150px; margin-left: 20px;margin-top: 20px;">Export
                                                Image</el-button>
                                            <el-button type="primary" @click="export_data(5)"
                                                style="width:150px; margin-left: 20px; margin-top: 20px;">Export
                                                Data</el-button>
                                        </div>
                                    </div>
                                </div>
                                <div id="footer-text5" style="display: none;" class="my-accordion accordion">
                                    <input type="checkbox" id="collapse4">
                                    <article>
                                        <label for="collapse4">Click here for a detailed description of the methods and
                                            results.</label>
                                        <ul style="font-weight: 700;">
                                            <li style="padding-top:10px;">
                                                Methods
                                            </li>
                                            <div class="text">Based on normalized and batch corrected BSJ,circRNA,gene
                                                expression,
                                                BloodCircR provides differential expression analysis of different groups
                                                in different
                                                phenotypes for 7 disease types (Cancer disease,Genetic
                                                disease,Infectious disease,
                                                Mental disorder,Metabolic disease,Retinal disease,Vaccine) and 14
                                                phenotypes(HCC,CF,Ebola,Chikv,Zika,TB,COVID,MISC,
                                                ILD,ID,MDD,T2D,PVR,Group B meningococcal vaccine),
                                                each of which has more than 4 pairs of disease and control samples.
                                                TThe fold change is calculated by mean(Case) / mean(Control),and the
                                                p-value was estimated by t-test.</div>
                                            <li>
                                                Interpretation
                                                <ul>
                                                    <li>
                                                        BloodCircR provides result figures, including:
                                                    </li>
                                                    <div class="text">The volcano plot presents the fold
                                                        change,up-regulated circRNA and linear RNA and
                                                        down-regulated circRNA and linear RNA.</div>
                                                    <li>
                                                        BloodCircR provides table for downloading, including:

                                                        <!--  <li>
                                                               Bubble plot:
                                                           </li>-->
                                                        <div class="text"
                                                            style=" white-space: normal;word-wrap: normal;">
                                                            The table presents detailed information about differential
                                                            expression analysis,including baseMeas, log2FoldChange,
                                                            lfcSE, stat, pvalue, padj, genename, detectN, detectR,
                                                            host_gene, Significant.
                                                        </div>
                                                    </li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </article>
                                </div>
                            </el-card>
                        </div>
                        <div class="sec2">
                            <div class="header">
                                <span>Enrichments(circ vs linear)</span>
                                <el-popover placement="top-start" title="Illustration" width="200" trigger="hover"
                                content="这是一段内容,这是一段内容,这是一段内容,这是一段内容。">
                                <img src="images/warning.png" slot="reference" alt="icon" class="icon-image"
                                    > <!-- 这里是图标图片 -->
                                </el-popover>
                            </div>
                            <el-card>
                                <div v-loading="loading6" element-loading-text="Loading"
                                    element-loading-spinner="el-icon-loading"
                                    element-loading-background="rgba(255, 255, 255, 0.8)" style="text-align: center;"
                                    style="padding:20px;">
                                    <!-- 上方按钮显示主体 -->
                                    <div
                                        style="display: flex; justify-content: start; flex-wrap:nowrap; margin-bottom:20px;">
                                        <el-select v-model="selectedType" placeholder="Select Type"
                                            style="width: 150px;margin-right: 20px;display: block;">
                                            <el-option v-for="type in types" :key="type" :label="type"
                                                :value="type"></el-option>
                                        </el-select>
                                        <el-select v-model="selectedDataset6" @change="selectimage6"
                                            placeholder="Please Select Dataset"
                                            style="width: 250px; margin-right: 20px;display: block;">
                                            <el-option v-for="dataset in selectedDatasets" :key="dataset"
                                                :label="dataset" :value="dataset"></el-option>
                                        </el-select>
                                        <el-select v-model="selectedCompare" placeholder="Select Compare"
                                            style="width: 200px; margin-right: 20px;display: block;">
                                            <el-option v-for="compare in compares" :key="compare" :label="compare"
                                                :value="compare"></el-option>
                                        </el-select>

                                    </div>
                                    <div
                                        style="display: flex;justify-content: end; align-items: center; margin-bottom: 20px;">
                                        PValue:<el-input v-model="pvalue4" placeholder="pvalue" type="number"
                                            step="0.05" style="width: 100px; margin: 0 20px;"></el-input>
                                        FoldChange:<el-input v-model="FoldChange4" placeholder="FoldChange"
                                            type="number" style="width: 100px;  margin: 0 20px;"></el-input>
                                        detectR:<el-input v-model="detectR4" placeholder="detectR" type="number"
                                            step="0.1" style="width: 100px; margin: 0 20px;"></el-input>
                                        <!-- Number:<el-input v-model="Number4" placeholder="Number" type="number"
						                    style="width: 100px;  margin-left: 20px;"></el-input>-->
                                        <el-button type="primary" style="width:100px; margin-left: 20px;"
                                            @click="get_plot6()">Go</el-button>
                                    </div>
                                    <!-- 图显示主体 -->
                                    <div v-for="([datasetname, image], index) in Object.entries(showimages6)"
                                        :key="datasetname">
                                        <div class="img_container">
                                            <!-- <img :src="image" style="height: 450px;width:auto;" alt=""> -->
                                            <img :src="image" style="width:80%;" alt="">
                                        </div>
                                        <div class="top_btn">
                                            <el-button type="primary" @click="export_image(6)"
                                                style="width:150px; margin-left: 20px;margin-top: 20px;">Export
                                                Image</el-button>
                                            <el-button type="primary" @click="export_data(6)"
                                                style="width:150px; margin-left: 20px; margin-top: 20px;">Export
                                                Data</el-button>
                                        </div>
                                    </div>
                                </div>
                                <div id="footer-text6" style="display: none;" class="my-accordion accordion">
                                    <input type="checkbox" id="collapse6">
                                    <article>
                                        <label for="collapse6">Click here for a detailed description of the methods and
                                            results.</label>
                                        <ul style="font-weight: 700;">
                                            <li style="padding-top:10px;">
                                                Methods
                                            </li>
                                            <div class="text">Based on the expression of circRNAs in total TPM,
                                                BloodCircR provides expression profiles of different groups in different
                                                phenotypes for 8 disease types () and 12 phenotypes,
                                                each of which has more than 4 pairs of disease and control samples.
                                                The expression level was calculated by xxx, and the p value was
                                                estimated by t test.</div>
                                            <li>
                                                Interpretation
                                                <ul>
                                                    <li>
                                                        BloodCircR provides result figures, including:
                                                    </li>
                                                    <div class="text">After selecting the disease type, phenotype, and
                                                        dataset through the menu bar on the left,
                                                        BloodCircR will display a box plot of total circRNA expression
                                                        for a single phenotype or for different groups of multiple
                                                        phenotypes.</div>
                                                    <li>
                                                        BloodCircR provides table for downloading, including:

                                                        <!--  <li>
						                                        Bubble plot:
						                                    </li>-->
                                                        <div class="text">This table provides the expression of
                                                            Total circular RNA in different phenotype groups,
                                                            including sampleID, disease type, group name, dataset
                                                            name, and TPM value.
                                                        </div>
                                                    </li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </article>
                                </div>
                            </el-card>
                        </div>
                    </el-tab-pane>

                </el-tabs>
            </div>
        </div>
        <!-- 使用定义的 footer 组件 -->
        <app-footer></app-footer>
    </div>
</body>

<!-- vue相关js -->
<script>
    new Vue({
        el: '#app',
        data() {
            return {
                isLoaded: false,
                loading1: false,
                loading2: false,
                loading3: false,
                loading4: false,
                loading5: false,
                loading6: false,

                activeName: 'first',

                images1: {},

                diseases: [],
                phenotypes: [],
                datasets: [],
                groups: [],
                selectedDiseases: [],
                selectedPhenotypes: [],
                selectedDatasets: [],
                groupsDisplay: '',



                showimages1: {},
                showimages2: {},
                showimages3: {},
                showimages4: {},
                showimages5: {},
                showimages6: {},

                allSelectedDatasets: '',
                selectedDataset3: '',
                selectedDataset4: '',
                selectedDataset5: '',
                selectedDataset6: '',

                selectedCircRNA: '',
                circRNAs: '',
                allSelectedCircRNAs: [],

                selectedMarker: 'bsj',
                selectedMarker1: 'bsj',
                selectedMarker2: 'bsj',
                allSelectedMarkers: ['bsj', 'isoform', 'gene'],

                dynamicPlaceholder: 'chr8|51860845|51861246|-,chr2|135748267|135755691|+',

                csvDatas1: {},

                csvData1: null,
                csvData2: null,
                csvData3: null,
                csvData4: null,
                csvData5: null,
                csvData6: null,

                imageUrl1: '',
                imageUrl2: '',
                imageUrl3: '',
                imageUrl4: '',
                imageUrl5: '',
                imageUrl6: '',

                pvalue1: 0.05,
                FoldChange1: 2,
                detectR1: 0.2,

                pvalue2: 0.05,
                FoldChange2: 2,
                detectR2: 0.2,
                Number2: 10,

                pvalue3: 0.05,
                FoldChange3: 2,

                pvalue4: 0.05,
                FoldChange4: 2,
                detectR4: 0.2,
                Number4: 10,

                selectedCompare1: '',
                compares1: [],

                selectedCompare3: '',
                compares3: [],

                selectedCompare2: '',
                compares2: [],
                selectedType2: '',
                types2: ['BP', 'CC', 'MF', 'KEGG', 'Reactome', 'GSEA'],

                selectedCompare: '',
                compares: [],
                selectedType: '',
                types: ['BP', 'CC', 'MF', 'KEGG', 'Reactome', 'GSEA'],

                styles: {},

                email: JSON.parse(localStorage.getItem('user')) || null,

                defaultErrorImage1: '',
                defaultErrorImage2: '',
                defaultErrorImage3: '',
                defaultErrorImage4: '',
                defaultErrorImage5: '',
                defaultErrorImage6: '',
            }
        },
        computed: {

        },
        mounted() {
            this.isLoaded = true;
            if (this.email) {
                this.email = this.email.email;
            } else {
                this.email = '';
            }
            this.fetchDiseases();
            const svgContent = `
            <svg xmlns="http://www.w3.org/2000/svg" width="400" height="200">
            <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="24" fill="#cccccc">
                No data available!
            </text>
            </svg>`;

            const base64SVG = btoa(svgContent);
            this.defaultErrorImage1 = 'data:image/svg+xml;base64,' + base64SVG;
            this.defaultErrorImage2 = 'data:image/svg+xml;base64,' + base64SVG;
            this.defaultErrorImage3 = 'data:image/svg+xml;base64,' + base64SVG;
            this.defaultErrorImage4 = 'data:image/svg+xml;base64,' + base64SVG;
            this.defaultErrorImage5 = 'data:image/svg+xml;base64,' + base64SVG;
            this.defaultErrorImage6 = 'data:image/svg+xml;base64,' + base64SVG;

        },
        methods: {
            showTooltip(index) {
                switch (index) {
                    case 1:
                        var headerText = document.getElementById("header-text1");
                        if (headerText.style.display === "none") {
                            // 显示并添加动画
                            headerText.style.display = "block";  // 先将display设为block，使元素可见
                            setTimeout(() => {
                                headerText.classList.add("open");
                            }, 10); // 小延迟触发动画
                        } else {
                            // 隐藏并添加动画
                            headerText.classList.remove("open");
                            setTimeout(() => {
                                headerText.style.display = "none"; // 延迟后隐藏元素
                            }, 300); // 等待动画完成后再将元素display设为none
                        }
                        break;
                    case 2:
                        var headerText = document.getElementById("header-text2");
                        if (headerText.style.display === "none") {
                            // 显示并添加动画
                            headerText.style.display = "block";  // 先将display设为block，使元素可见
                            setTimeout(() => {
                                headerText.classList.add("open");
                            }, 10); // 小延迟触发动画
                        } else {
                            // 隐藏并添加动画
                            headerText.classList.remove("open");
                            setTimeout(() => {
                                headerText.style.display = "none"; // 延迟后隐藏元素
                            }, 300); // 等待动画完成后再将元素display设为none
                        }
                        break;
                    case 3:
                        var headerText = document.getElementById("header-text3");
                        if (headerText.style.display === "none") {
                            // 显示并添加动画
                            headerText.style.display = "block";  // 先将display设为block，使元素可见
                            setTimeout(() => {
                                headerText.classList.add("open");
                            }, 10); // 小延迟触发动画
                        } else {
                            // 隐藏并添加动画
                            headerText.classList.remove("open");
                            setTimeout(() => {
                                headerText.style.display = "none"; // 延迟后隐藏元素
                            }, 300); // 等待动画完成后再将元素display设为none
                        }
                        break;
                    case 4:
                        var headerText = document.getElementById("header-text4");
                        if (headerText.style.display === "none") {
                            // 显示并添加动画
                            headerText.style.display = "block";  // 先将display设为block，使元素可见
                            setTimeout(() => {
                                headerText.classList.add("open");
                            }, 10); // 小延迟触发动画
                        } else {
                            // 隐藏并添加动画
                            headerText.classList.remove("open");
                            setTimeout(() => {
                                headerText.style.display = "none"; // 延迟后隐藏元素
                            }, 300); // 等待动画完成后再将元素display设为none
                        }
                        break;
                    case 5:
                        var headerText = document.getElementById("header-text5");
                        if (headerText.style.display === "none") {
                            // 显示并添加动画
                            headerText.style.display = "block";  // 先将display设为block，使元素可见
                            setTimeout(() => {
                                headerText.classList.add("open");
                            }, 10); // 小延迟触发动画
                        } else {
                            // 隐藏并添加动画
                            headerText.classList.remove("open");
                            setTimeout(() => {
                                headerText.style.display = "none"; // 延迟后隐藏元素
                            }, 300); // 等待动画完成后再将元素display设为none
                        }
                        break;
                    case 6:
                        var headerText = document.getElementById("header-text6");
                        if (headerText.style.display === "none") {
                            // 显示并添加动画
                            headerText.style.display = "block";  // 先将display设为block，使元素可见
                            setTimeout(() => {
                                headerText.classList.add("open");
                            }, 10); // 小延迟触发动画
                        } else {
                            // 隐藏并添加动画
                            headerText.classList.remove("open");
                            setTimeout(() => {
                                headerText.style.display = "none"; // 延迟后隐藏元素
                            }, 300); // 等待动画完成后再将元素display设为none
                        }
                        break;
                }
            },
            changeMarkerName() {
                // 根据 marker 的值进行处理和转换
                if (this.selectedMarker === 'bsj') {
                    this.circRNAs = '';
                    this.dynamicPlaceholder = 'chr8|51860845|51861246|-,chr2|135748267|135755691|+';
                } else if (this.selectedMarker === 'isoform') {
                    this.circRNAs = '';
                    this.dynamicPlaceholder = 'circABHD2_0061,circFAM13B_0319,circGPBP1L1_0230,circPCMTD1_0361,circUBXN4_0034,circZNF609_0019';
                } else {
                    this.circRNAs = '';
                    this.dynamicPlaceholder = 'PCMTD1,ABHD2,UBXN4,ZNF609';
                }
            },
            formatLabel(marker) {
                // 根据 marker 的值进行处理和转换
                if (marker === 'bsj') {
                    return 'BSJ';
                } else if (marker === 'isoform') {
                    return 'circRNA';
                }
                // 或者进行其他更复杂的逻辑处理
                return 'host gene';
            },
            handleInputBlur() {
                if (this.circRNAs) {  // 先判断 circRNAs 是否为空
                    this.allSelectedCircRNAs = this.circRNAs.split(',');
                    this.selectedCircRNA = this.allSelectedCircRNAs[0];
                } else {
                    // 可以根据您的需求在这里处理 circRNAs 为空的情况，比如给出提示或进行默认处理
                    this.$message.warning("Input can't be null");
                }
            },
            handleTabClick(tab, event) {
                console.log(this.activeName);
            },
            export_data(index) {
                let tablename, datasetname;
                const get_data = (csvData, tablename, datasetname, index) => {
                    if (csvData) {
                        const blob = new Blob([csvData], { type: 'text/csv;charset=utf-8;' });
                        const link = document.createElement('a');
                        const url = URL.createObjectURL(blob);
                        link.setAttribute('href', url);
                        link.setAttribute('download', tablename + '_' + datasetname + '_data.csv');
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    } else {
                        console.error('CSV数据尚未获取');
                    }
                };
                switch (index) {
                    case 1:
                        tablename = 'expression_1'; // 替换为实际的表格名
                        datasetname = this.allSelectedDatasets; // 替换为实际的数据集名称
                        get_data(this.csvData1, tablename, datasetname, index)
                        break;
                    case 2:
                        tablename = 'expression_2'; // 替换为实际的表格名
                        datasetname = this.allSelectedDatasets; // 替换为实际的数据集名称
                        get_data(this.csvData2, tablename, datasetname, index)
                        break;
                    case 3:
                        tablename = 'differential_expression_1'; // 替换为实际的表格名
                        datasetname = this.selectedDataset3; // 替换为实际的数据集名称
                        get_data(this.csvData3, tablename, datasetname, index)
                        break;
                    case 4:
                        tablename = 'differential_expression_2'; // 替换为实际的表格名
                        datasetname = this.selectedDataset4; // 替换为实际的数据集名称
                        get_data(this.csvData4, tablename, datasetname, index)
                        break;
                    case 5:
                        tablename = 'differential_expression_3'; // 替换为实际的表格名
                        datasetname = this.selectedDataset5; // 替换为实际的数据集名称
                        get_data(this.csvData5, tablename, datasetname, index)
                        break;
                    case 6:
                        tablename = 'differential_expression_4'; // 替换为实际的表格名
                        datasetname = this.selectedDataset6; // 替换为实际的数据集名称
                        get_data(this.csvData6, tablename, datasetname, index)
                        break;
                    default:
                        console.error('Invalid index:', index);
                        return;
                }
            },
            export_image(index) {
                let tablename, datasetname;
                const get_image = (imageUrl, tablename, datasetname, index) => {
                    if (imageUrl) {
                        const link = document.createElement('a');
                        link.href = imageUrl;
                        link.setAttribute('download', tablename + '_' + datasetname + '.svg'); // 修改下载的文件名
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    } else {
                        console.error('image数据尚未获取');
                    }
                };
                // 根据index的值设置tablename和datasetname
                switch (index) {
                    case 1:
                        tablename = 'expression_1'; // 替换为实际的表格名
                        datasetname = this.allSelectedDatasets; // 替换为实际的数据集名称
                        get_image(this.imageUrl1, tablename, datasetname, index)
                        break;
                    case 2:
                        tablename = 'expression_2'; // 替换为实际的表格名
                        datasetname = this.allSelectedDatasets; // 替换为实际的数据集名称
                        get_image(this.imageUrl2, tablename, datasetname, index)
                        break;
                    case 3:
                        tablename = 'differential_expression_1'; // 替换为实际的表格名
                        datasetname = this.selectedDataset3; // 替换为实际的数据集名称
                        get_image(this.imageUrl3, tablename, datasetname, index)
                        break;
                    case 4:
                        tablename = 'differential_expression_2'; // 替换为实际的表格名
                        datasetname = this.selectedDataset4; // 替换为实际的数据集名称
                        get_image(this.imageUrl4, tablename, datasetname, index)
                        break;
                    case 5:
                        tablename = 'differential_expression_3'; // 替换为实际的表格名
                        datasetname = this.selectedDataset5; // 替换为实际的数据集名称
                        get_image(this.imageUrl5, tablename, datasetname, index)
                        break;
                    case 6:
                        tablename = 'differential_expression_4'; // 替换为实际的表格名
                        datasetname = this.selectedDataset6; // 替换为实际的数据集名称
                        get_image(this.imageUrl6, tablename, datasetname, index)
                        break;
                    default:
                        console.error('Invalid index:', index);
                        return;
                }
            },
            handleTabKey1(event) {
                if (event.key === 'Tab') {
                    event.preventDefault(); // 防止默认的 Tab 行为
                    if (!this.circRNAs) {
                        this.circRNAs = event.target.placeholder;
                    }
                }
            },
            onImageLoad(datasetname, event, index) {
                // this[`loading${index}`] = true;
                const img = event.target;
                const containerWidth = img.parentElement.clientWidth;
                const imgWidth = img.naturalWidth;

                if (imgWidth > containerWidth) {
                    this.$set(this.styles, datasetname, {
                        height: '450px',
                        width: 'auto'
                    });
                } else {
                    this.$set(this.styles, datasetname, {
                        height: 'auto',
                        width: '60%'
                    });
                }
                // this[`loading${index}`] = false;
            },
            getcircRNAplot() {
                if (!this.allSelectedDatasets) {
                    this.$message.error('Please select a dataset.');
                    return;
                }

                if (!this.selectedCircRNA) {
                    this.$message.error('Please select circRNA.');
                    return;
                }

                // 继续处理逻辑
                console.log('Selected Dataset:', this.allSelectedDatasets);
                console.log('Input circRNAs:', this.circRNAs);
                this.loading2 = true;
                this.showimages2 = {};
                this.csvData2 = null;
                this.imageUrl2 = '';

                const defaultErrorData = null;
                const fetchImageSVG = (datasetname, marker, circRNAs, mode) => {
                    const FormData = { datasetname: datasetname, marker: marker, circRNAs: circRNAs };
                    console.log(FormData);
                    const url = './interface/' + mode + '.php';
                    console.log(url);
                    return axios.post(url, {}, { params: FormData })
                        .then(response => {
                            console.log(response.data);
                            const imageData = response.data.image1;
                            const csvData = response.data.data1;
                            if (imageData && csvData) {
                                const imageUrl = this.convertSVGBase64ToUrl(imageData);
                                const csvUrl = atob(csvData);
                                
                                return { imageUrl, csvUrl };
                            } else {
                                const imageUrl = this.defaultErrorImage1;
                                const csvUrl = defaultErrorData;
                                
                                return { imageUrl, csvUrl }; // 返回默认错误图像
                            }

                        })
                        .catch(error => {
                            console.error(`Error fetching image for ${datasetname} with mode ${mode}:`, error);
                            const imageUrl = this.defaultErrorImage1;
                            const csvUrl = defaultErrorData;
                            return { imageUrl, csvUrl }; // 返回默认错误图像
                        });
                };
                fetchImageSVG(this.allSelectedDatasets, this.selectedMarker, this.selectedCircRNA, 'expression_2')
                    .then(data => {
                        console.log(data);
                        this.loading2 = false;
                        this.imageUrl2 = data.imageUrl;
                        this.csvData2 = data.csvUrl;
                        this.showimages2[this.allSelectedDatasets] = data.imageUrl;
                        console.log(this.showimages2);
                        let footerText = document.getElementById("footer-text2");
                        footerText.style.display = "block";
                    })
                    .catch(error => {
                        this.loading2 = false;
                        console.error('Error fetching image:', error);
                        let footerText = document.getElementById("footer-text2");
                        footerText.style.display = "none";
                    })
            },
            selectimage1() {
                // 处理选择图片逻辑
                this.imageUrl1 = this.showimages1[this.allSelectedDatasets];
                this.csvData1 = this.csvDatas1[this.allSelectedDatasets];
            },
            selectimage3() {
                this.loading3 = true;
                // 处理选择图片逻辑
                console.log(this.selectedDataset3);
                const datasetname = this.selectedDataset3;
                axios.post('./interface/differential_compare_get.php', {}, { params: { datasetname: datasetname } })
                    .then(response => {
                        console.log('test1:', response.data);
                        this.compares1 = response.data.data;
                        this.selectedCompare1 = this.compares1[0];
                        this.loading3 = false;
                    })
                    .catch(error => {
                        console.error('Error fetching diseases:', error);
                        this.loading3 = false;
                    });
            },
            selectimage4() {
                this.loading4 = true;
                console.log(this.selectedDataset4);
                const datasetname = this.selectedDataset4;
                axios.post('./interface/differential_compare_get.php', {}, { params: { datasetname: datasetname } })
                    .then(response => {
                        console.log('test:', response.data);
                        this.compares2 = response.data.data;
                        this.selectedCompare2 = this.compares2[0];
                        this.selectedType2 = 'BP';
                        this.loading4 = false;
                    })
                    .catch(error => {
                        console.error('Error fetching diseases:', error);
                        this.loading4 = false;
                    });
            },
            selectimage5() {
                this.loading5 = true;
                // 处理选择图片逻辑
                console.log(this.selectedDataset5);
                const datasetname = this.selectedDataset5;
                axios.post('./interface/differential_compare_get.php', {}, { params: { datasetname: datasetname } })
                    .then(response => {
                        console.log('test3:', response.data);
                        this.compares3 = response.data.data;
                        this.selectedCompare3 = this.compares3[0];
                        this.loading5 = false;
                    })
                    .catch(error => {
                        console.error('Error fetching diseases:', error);
                        this.loading5 = false;
                    });
            },
            selectimage6() {
                this.loading6 = true;
                // 处理选择图片逻辑
                console.log(this.selectedDataset6);
                const datasetname = this.selectedDataset6;
                axios.post('./interface/differential_compare_get.php', {}, { params: { datasetname: datasetname } })
                    .then(response => {
                        console.log('test:', response.data);
                        this.compares = response.data.data;
                        this.selectedCompare = this.compares[0];
                        this.selectedType = 'BP';
                        this.loading6 = false;
                    })
                    .catch(error => {
                        console.error('Error fetching diseases:', error);
                        this.loading6 = false;
                    });
            },
            fetchDiseases() {
                axios.get(`./interface/dataset_select.php?action=getDiseases&email=${this.email}`)
                    .then(response => {
                        console.log(response.data);
                        this.diseases = response.data;
                    })
                    .catch(error => {
                        console.error('Error fetching diseases:', error);
                    });
            },
            fetchPhenotypes() {
                this.phenotypes = [];
                this.selectedPhenotypes = [];
                this.datasets = [];
                this.selectedDatasets = [];
                this.groups = [];
                this.groupsDisplay = '';
                if (this.selectedDiseases.length) {
                    const diseases = this.selectedDiseases.join(',');
                    axios.get(`./interface/dataset_select.php?action=getPhenotypes&diseases=${diseases}&email=${this.email}`)
                        .then(response => {
                            console.log(response.data);
                            this.phenotypes = response.data;
                        })
                        .catch(error => {
                            console.error('Error fetching phenotypes:', error);
                        });
                }
            },
            fetchDatasets() {
                this.datasets = [];
                this.selectedDatasets = [];
                this.groups = [];
                this.groupsDisplay = '';
                if (this.selectedPhenotypes.length) {
                    const phenotypes = this.selectedPhenotypes.join(',');
                    axios.get(`./interface/dataset_select.php?action=getDatasets&phenotypes=${phenotypes}&email=${this.email}`)
                        .then(response => {
                            console.log(response.data);
                            this.datasets = response.data;
                        })
                        .catch(error => {
                            console.error('Error fetching datasets:', error);
                        });
                }
            },
            convertSVGBase64ToUrl(base64) {
                const byteString = atob(base64);
                const ab = new ArrayBuffer(byteString.length);
                const ia = new Uint8Array(ab);
                for (let i = 0; i < byteString.length; i++) {
                    ia[i] = byteString.charCodeAt(i);
                }
                const blob = new Blob([ia], { type: 'image/svg+xml' });
                return URL.createObjectURL(blob);
            },
            convertPNGBase64ToUrl(base64) {
                const byteString = atob(base64);
                const ab = new ArrayBuffer(byteString.length);
                const ia = new Uint8Array(ab);
                for (let i = 0; i < byteString.length; i++) {
                    ia[i] = byteString.charCodeAt(i);
                }
                const blob = new Blob([ia], { type: 'image/png' });
                return URL.createObjectURL(blob);
            },
            get_plot1() {
                if (this.selectedDiseases.length === 0) {
                    this.$message.error('Please select at least one Disease.');
                    return;
                }
                if (this.selectedPhenotypes.length === 0) {
                    this.$message.error('Please select at least one Phenotype.');
                    return;
                }
                if (this.selectedDatasets.length === 0) {
                    this.$message.error('Please select at least one Dataset.');
                    return;
                }
                console.log("图数据");
                this.loading1 = true;
                const datasetnames = this.selectedDatasets; // 获取参数的值
                console.log(datasetnames);
                if (datasetnames.length === 1) {
                    this.allSelectedDatasets = datasetnames[0];
                } else {
                    const datasetString = datasetnames.join(","); // 将数组中的元素用逗号连接成字符串
                    console.log(datasetString);
                    this.allSelectedDatasets = datasetString; //
                    console.log(this.allSelectedDatasets);
                }
                // 初始化图像对象
                this.images1 = {};
                this.csvDatas1 = {};
                const defaultErrorData = null;
                const fetchImageSVG = async (datasetname, mode) => {
                    const FormData = { datasetname: datasetname };
                    console.log(FormData);
                    const url = './interface/' + mode + '.php';
                    console.log(url);
                    try {
                        const response = await axios.post(url, {}, { params: FormData });
                        const imageData = response.data.image1;
                        const csvData = response.data.data1;
                        if (imageData && csvData) {
                            const imageUrl = await this.convertSVGBase64ToUrl(imageData);
                            const csvUrl = atob(csvData);
                            return { imageUrl, csvUrl };
                        } else {
                            const imageUrl = this.defaultErrorImage2;
                            const csvUrl = defaultErrorData;
                            return { imageUrl, csvUrl }; // 返回默认错误图像
                        }
                    } catch (error) {
                        console.error(`Error fetching image for ${datasetname} with mode ${mode}:`, error);
                        const imageUrl = this.defaultErrorImage2;
                        const csvUrl = defaultErrorData;
                        return { imageUrl, csvUrl }; // 返回默认错误图像
                    }
                };
                fetchImageSVG(this.allSelectedDatasets, 'expression_1')
                    .then(result => {
                        console.log(result);
                        this.images1[this.allSelectedDatasets] = result.imageUrl;
                        this.csvDatas1[this.allSelectedDatasets] = result.csvUrl;
                        console.log(this.images1);
                        this.showimages1 = this.images1;
                        this.selectimage1();
                        this.loading1 = false;
                        let footerText = document.getElementById("footer-text1");
                        footerText.style.display = "block";  // 先将display设为block，使元素可见
                    }).catch(error => {
                        console.error('Error in fetching images:', error);
                        alert('Failed to fetch images. Please check the console for more details.');
                        this.loading1 = false;
                        let footerText = document.getElementById("footer-text1");
                        footerText.style.display = "none";
                    });
            },
            get_plot3() {
                console.log("图数据");
                this.showimages3 = {};
                this.csvData3 = null;
                this.imageUrl3 = '';
                this.loading3 = true;
                console.log(this.selectedDataset3);
                console.log(this.selectedCompare1);
                console.log(this.selectedMarker1);
                console.log(this.detectR1);
                console.log(this.pvalue1);
                console.log(this.FoldChange1);



                const FormData = { datasetname: this.selectedDataset3, compare: this.selectedCompare1, level: this.selectedMarker1, pvalue: this.pvalue1, FoldChange: this.FoldChange1, detectR: this.detectR1 };
                console.log(FormData);
                axios.post('./interface/differential_expression_1.php', {}, { params: FormData })
                    .then(response => {
                        const imageData = response.data.image1;
                        if (imageData) {
                            // Convert base64 data to Blob URL
                            const url = this.convertSVGBase64ToUrl(imageData);
                            console.log(url);
                            this.imageUrl3 = url;
                            this.showimages3[this.selectedDataset3] = url;
                            let footerText = document.getElementById("footer-text3");
                            footerText.style.display = "block";  // 先将display设为block，使元素可见
                        } else {
                            this.showimages3[this.selectedDataset3] = this.defaultErrorImage3; // Return default error image
                            console.log(this.showimages3);
                            console.error('Error:', response.data.error);
                            let footerText = document.getElementById("footer-text3");
                            footerText.style.display = "none"; 
                        }

                        if (response.data.data1) {
                            this.csvData3 = atob(response.data.data1);
                        } else {
                            console.error('Error:', response.data.error);
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching diseases:', error);
                        this.showimages3[this.selectedDataset3] = this.defaultErrorImage3;
                        console.log(this.showimages3);
                        let footerText = document.getElementById("footer-text3");
                        footerText.style.display = "none"; 
                    })
                    .finally(() => {
                        // Set loading3 to false in the finally block to ensure it happens after all processing
                        this.loading3 = false;
                        let footerText = document.getElementById("footer-text3");
                        footerText.style.display = "none"; 
                    });

            },
            get_plot4() {
                console.log('test2');
                console.log(this.selectedDataset4);
                console.log(this.selectedCompare2);
                console.log(this.selectedType2);
                console.log(this.pvalue2);
                console.log(this.FoldChange2);
                console.log(this.selectedMarker2);
                this.showimages4 = {};
                this.csvData4 = null;
                this.imageUrl4 = '';
                this.loading4 = true;

                const FormData = { datasetname: this.selectedDataset4, compare: this.selectedCompare2, level: this.selectedMarker2, type: this.selectedType2, pvalue: this.pvalue2, FoldChange: this.FoldChange2, detectR: this.detectR2, number: this.Number2 };
                axios.post('./interface/differential_expression_2.php', {}, { params: FormData })
                    .then(response => {
                        const imageData = response.data.image1;

                        if (imageData) {
                            // Convert base64 data to Blob URL
                            const url = this.convertSVGBase64ToUrl(imageData);
                            console.log(url);
                            this.imageUrl4 = url;
                            this.showimages4[this.selectedDataset4] = url;
                            let footerText = document.getElementById("footer-text4");
                            footerText.style.display = "block";
                        } else {
                            // Set default error image if imageData is not present
                            this.showimages4[this.selectedDataset4] = this.defaultErrorImage4;
                            console.error('Image data error:', response.data.error || 'No image data returned');
                            let footerText = document.getElementById("footer-text4");
                            footerText.style.display = "none";
                        }

                        if (response.data.data1) {
                            this.csvData4 = atob(response.data.data1);
                        } else {
                            console.error('CSV data error:', response.data.error || 'No CSV data returned');
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching diseases:', error);
                        this.showimages4[this.selectedDataset4] = this.defaultErrorImage4;
                        let footerText = document.getElementById("footer-text4");
                        footerText.style.display = "none";
                    })
                    .finally(() => {
                        // Ensure loading state is updated after all processing
                        this.loading4 = false;
                        let footerText = document.getElementById("footer-text4");
                        footerText.style.display = "none";
                    });

            },
            get_plot5() {
                console.log("图数据");
                this.showimages5 = {};
                this.csvData5 = null;
                this.imageUrl5 = '';
                this.loading5 = true;
                console.log(this.selectedDataset5);
                console.log(this.selectedCompare3);



                const FormData = { datasetname: this.selectedDataset5, compare: this.selectedCompare3, pvalue: this.pvalue3, FoldChange: this.FoldChange3, };
                console.log(FormData);
                axios.post('./interface/differential_expression_3.php', {}, { params: FormData })
                    .then(response => {
                        const imageData = response.data.image1;

                        if (imageData) {
                            // Convert base64 data to Blob URL
                            const url = this.convertSVGBase64ToUrl(imageData);
                            console.log('Generated Image URL:', url);
                            this.imageUrl5 = url;
                            this.showimages5[this.selectedDataset5] = url;
                            let footerText = document.getElementById("footer-text5");
                            footerText.style.display = "block";
                        } else {
                            // Set default error image if imageData is missing
                            this.showimages5[this.selectedDataset5] = this.defaultErrorImage5;
                            console.error('Error: No image data returned');
                            let footerText = document.getElementById("footer-text5");
                            footerText.style.display = "none";
                        }

                        const csvData = response.data.data1;
                        if (csvData) {
                            this.csvData5 = atob(csvData);
                        } else {
                            console.error('Error: No CSV data returned');
                        }
                    })
                    .catch(error => {
                        // Log error message and set default error image
                        console.error('Error fetching diseases:', error);
                        this.showimages5[this.selectedDataset5] = this.defaultErrorImage5;
                        let footerText = document.getElementById("footer-text5");
                        footerText.style.display = "none";
                    })
                    .finally(() => {
                        // Ensure loading state is updated after promise resolution
                        this.loading5 = false;
                        console.log('Finished loading data for dataset:', this.selectedDataset5);
                        let footerText = document.getElementById("footer-text5");
                        footerText.style.display = "none";
                    });

            },
            get_plot6() {
                console.log('test');
                console.log(this.selectedDataset6);
                console.log(this.selectedCompare);
                console.log(this.selectedType);
                console.log(this.pvalue4);
                console.log(this.FoldChange4);
                this.showimages6 = {};
                this.loading6 = true;
                this.csvData6 = null;
                this.imageUrl6 = '';

                const FormData = { datasetname: this.selectedDataset6, compare: this.selectedCompare, type: this.selectedType, pvalue: this.pvalue4, FoldChange: this.FoldChange4, detectR: this.detectR4, number: this.Number4 };
                axios.post('./interface/differential_expression_4.php', {}, { params: FormData })
                    .then(response => {
                        // Move loading state to finally block for consistency
                        const imageData = response.data.image1;

                        if (imageData) {
                            // Convert base64 data to Blob URL
                            const url = this.convertSVGBase64ToUrl(imageData);
                            console.log('Image URL:', url);
                            this.imageUrl6 = url;
                            this.showimages6[this.selectedDataset6] = url;
                            let footerText = document.getElementById("footer-text6");
                            footerText.style.display = "block";
                        } else {
                            // If no image data is available, show the default error image
                            this.showimages6[this.selectedDataset6] = this.defaultErrorImage6;
                            console.error('Error: No image data found');
                            let footerText = document.getElementById("footer-text6");
                            footerText.style.display = "none";
                        }

                        const csvData = response.data.data1;
                        if (csvData) {
                            this.csvData6 = atob(csvData);
                        } else {
                            console.error('Error: No CSV data returned');
                        }
                    })
                    .catch(error => {
                        // Handle any network or server errors
                        console.error('Error fetching diseases:', error);
                        this.showimages6[this.selectedDataset6] = this.defaultErrorImage6;
                        let footerText = document.getElementById("footer-text6");
                        footerText.style.display = "none";
                    })
                    .finally(() => {
                        // Ensure the loading state is updated regardless of success or failure
                        this.loading6 = false;
                        console.log('Data loading complete for dataset:', this.selectedDataset6);
                        let footerText = document.getElementById("footer-text6");
                        footerText.style.display = "none";
                    });

            },
            get_plots() {
                if (this.selectedDiseases.length === 0) {
                    this.$message.error('Please select at least one Disease.');
                    return;
                }
                if (this.selectedPhenotypes.length === 0) {
                    this.$message.error('Please select at least one Phenotype.');
                    return;
                }
                if (this.selectedDatasets.length === 0) {
                    this.$message.error('Please select at least one Dataset.');
                    return;
                }
                console.log("图数据");
                const datasetnames = this.selectedDatasets; // 获取参数的值
                console.log(datasetnames);
                if (datasetnames.length === 1) {
                    this.allSelectedDatasets = datasetnames;
                } else {
                    const datasetString = datasetnames.join(","); // 将数组中的元素用逗号连接成字符串
                    console.log(datasetString);
                    this.allSelectedDatasets = [datasetString, ...datasetnames]; // 将 datasetString 加到 datasetnames 最前面
                    console.log(this.allSelectedDatasets);
                }
                console.log(datasetnames);
                switch (this.activeName) {
                    case 'first':
                        this.get_plot1();
                        break;
                    case 'second':
                        const datasetnames = this.selectedDatasets; // 获取参数的值
                        console.log(datasetnames);
                        if (datasetnames.length === 1) {
                            this.allSelectedDatasets = datasetnames[0];
                        } else {
                            const datasetString = datasetnames.join(","); // 将数组中的元素用逗号连接成字符串
                            console.log(datasetString);
                            this.allSelectedDatasets = datasetString; //
                            console.log(this.allSelectedDatasets);
                        }
                        break;
                    case 'third':
                        this.selectedDataset3 = this.selectedDatasets[0];
                        this.selectedDataset5 = this.selectedDatasets[0];
                        this.selectedDataset4 = this.selectedDatasets[0];
                        this.selectedDataset6 = this.selectedDatasets[0];

                        try {
                            // 等待 selectimage 函数全部执行完毕
                            this.selectimage3();
                            this.selectimage5();
                            this.selectimage4();
                            this.selectimage6();
                            setTimeout(() => {
                                this.get_plot3();
                                this.get_plot5();
                                this.get_plot4();
                                this.get_plot6();
                            }, 1000);
                            console.log("All functions executed successfully");


                        } catch (error) {
                            console.error("An error occurred:", error);


                        }
                        break;
                }
            },
            reset() {
                this.diseases = [];
                this.selectedDiseases = [];
                this.phenotypes = [];
                this.selectedPhenotypes = [];
                this.datasets = [];
                this.selectedDatasets = [];
                this.groups = [];
                this.groupsDisplay = '';
                this.fetchDiseases();
            },

        }
    })
</script>

</html>